<head><title><%=@currentQuiz.subject%> | Resultados</title></head><div id='navbar' style='background-color: black;'><ul>
    <%=link_to '/' do %>
        <li id='nav-li-Home' class='li-result'><%=fa_icon 'home'%> <span class='erasable'>Home</span></li>
    <% end %>

    <%=link_to '/data' do %>
        <li id='nav-li-Data' class='li-result'><%=fa_icon 'file'%> <span class='erasable'>Data</span></li>
    <% end %>

    <%=link_to '/quiz' do %>
        <li id='nav-li-Practice' class='li-result'><%=fa_icon 'align-left'%> <span class='erasable'>Practice</span></li>
    <% end %>

    <%=link_to '/about' do %>
        <li id='nav-li-About' class='li-result'><%=fa_icon 'question'%> <span class='erasable'>About</span></li>
    <% end %>

    <li id='nav-li-Time' class='li-result time li-right'><%= @duration.min %>m <%= @duration.sec %>s</li>
</ul></div>
<%= audio_tag(@fanfare, autoplay: true)%>
<div id='page'><div style='padding: 30px'>
    <%= render "format-#{@currentQuiz.format}"%>

    <% @questionObjects.each do |question| %>
        <p style='position: relative'><% 
        @ans = @answerObjects[@questionObjects.index(question)]
        @parameters = eval(@ans.parameters)
           if @parameters[:data] 
                @data = @parameters[:data]
           else
                @data = false
           end
        @type = @parameters[:type]
        @right= if @type == :formula
                    puts "HEY"
                    puts @parameters[:data].to_s
                    truth = eval(eval(%Q(sprintf('#{question.answer}',#{@parameters[:data].join(',')}))))
                    @ans.attempt.to_i == truth
                else 
                    if eval(question.parameters).include?(:strict_order)
                        question.answer.downcase.split('|') == @ans.attempt.downcase.split('|')
                    else
                        question.answer.downcase.split('|').sort == @ans.attempt.downcase.split('|').sort
                    end
                end
        if @right
            %><span style='position: relative'><span class='grade'><%=%><%=number_with_precision @ans.grade, significant: true, precision: 2, separator: ',' %></span></span><%
        else
            %><span style='position: relative'><span class='grade'>0,0</span></span><%
        end
        %><b><%=(@questionObjects.index(question) + 1 ).to_s + '. ' %></b> <%= @data ? eval(%Q(sprintf("#{question.question.gsub(/#<(.*?)>/,"%d")}",#{@data.join(',')}))).html_safe  : question.question.html_safe %><br>
        <% if question.image.attached? %><%=image_tag(question.image.url, class: 'qImage')%><br><% end %>
        <%

        case @type
        when :open 
            if @right 
                %><span class='ck'></span><%
            elsif @ans.attempt != ""
                %><span class='ek'></span><% 
            end
            %><span class='input-answer'><%= @ans.attempt %></span>
            <% unless @right %><span class='red input-answer'><b>R:</b> <%= question.answer %></span> <% end %>
            </p><%

        when :choice
            @question = question
            order_choices
            @choices.each do |choice|
                %><b><% 
                @check_question = @question.answer.split('|').include?(choice)
                @check_answer = @ans.attempt.split('|').include?(choice)
                if @check_answer && @check_question
                %><span class='red'> ✓</span> </b><%= choice.html_safe %><br><%
                elsif !@check_answer && @check_question
                %><span class='red'> 𝒪</span> </b><%= choice.html_safe %><br><%
                elsif @check_answer && !@check_question
                %><span class='red'> ✗</span> </b><%= choice.html_safe %><br><%
                else
                %> ◯ </b><%= choice.html_safe %><br><%
                end
            end

        when :multichoice
            @question = question
            order_choices
            @choices.each do |choice|
                %><b><% 
                @check_question = @question.answer.split('|').include?(choice)
                @check_answer = @ans.attempt.split('|').include?(choice)
                if @check_answer && @check_question
                %><span class='red'> ✓</span> </b><%= choice.html_safe %><br><%
                elsif !@check_answer && @check_question
                %><span class='red'> 𝒪</span> </b><%= choice.html_safe %><br><%
                elsif @check_answer && !@check_question
                %><span class='red'> ✗</span> </b><%= choice.html_safe %><br><%
                else
                %> ◯ </b><%= choice.html_safe %><br><%
                end
            end

        when :veracity
            @question = question
            order_choices
            @choices.each do |choice|
                %><b><% 
                @check_question = @question.answer.split('|').include?(choice)
                @check_answer = @ans.attempt.split('|').include?(choice)
                if @check_answer && @check_question
                %><span class='blue'> 𝒱</span> </b><%= choice.html_safe %><span class='red'> ✓</span><br><%
                elsif @check_answer && !@check_question
                %><span class='blue'> 𝒱</span> </b><%= choice.html_safe %><span class='red'> ✗</span><br><%
                elsif !@check_answer && @check_question
                %><span class='blue'> ℱ</span> </b><%= choice.html_safe %><span class='red'> ✗</span><br><%
                else
                %><span class='blue'> ℱ</span> </b><%= choice.html_safe %><span class='red'> ✓</span><br><%
                end
            end

        when :caption
            %><% @real_alts = question.answer.split('|')
                @ans.attempt.split('|').each do |str|
                if @real_alts.include?(str)
                %><span class='input-answer'><%= str %></span><span class='input-answer red '> ✓</span><br><%
                    @real_alts -= [str]
                else
                    %><span class='striket input-answer'><%= str %></span><span class='input-answer red '> ✗</span><br><%
                end
            end %><span class='red input-answer'><%= @real_alts.join("<br>").html_safe%></span></p><%

        when :table

        when :formula
            if @right
                %><span class='ck'></span><%
            elsif @ans.attempt != ""
                %><span class='ek'></span><% 
            end
            %><span class='input-answer'><%= @ans.attempt %></span>
            <% unless @right %><span class='red input-answer'><b>R:</b> <%= truth %></span> <% end %>
            </p><%

        end
        
    end %>
</div></div>